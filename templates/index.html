<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>Video Editor</title>

    <link rel="stylesheet" href="static/main.css">

</head>

<body style="background-color:#1d1d1d;">
    <div style="text-align: center;">
        <img style="width:960px;height:540px; border-radius: 20px; box-shadow: 6px 4px 8px #000000;" src="{{ url_for('video_feed') }}">
       <div>
            <div style="display: inline-block; font-size: 24px; color: white;">Position:</div>
            <div style=" display: inline-block;font-size: 28px; color: white;" id="positionValue"></div>
            <div><input style="-webkit-appearance: none; appearance: none; width: 1200px;" type="range" min="1" max="1000" step="1" value="50" class="slider" id="positionId">            </div>
       </div>
        <div style="display: inline-block; max-width: 1300px; text-align: center;">
            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Edge Blur:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; width: 600px;" type="range" min="1" max="100" step="3" value="50" class="slider" id="cannyBlurId">            </div>
            </div>
           
            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Background Blur:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; width: 600px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Threshold Details:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; width: 600px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Threshold Lines:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; width: 600px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Line Thickness:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; width: 600px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>  
        </div>

        <div id="grid">
            <div>
                <h2>RENDERED</h2>
                <h1 id="num" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h2>TOTAL:</h2>
                <h1 id="framesCount" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h2>PROGRESS:</h2>
                <h1 id="progress" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h2>FPS:</h2>
                <h1 id="fps" style="color: rgb(255, 255, 255);">0</h1>
            </div>

            <div>
                <h2>CPU LOAD</h2>
                <h1 id="cpu" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h2>FREE RAM</h2>
                <h1 id="freeRam" style="color: rgb(255, 255, 255);"></h1>
            </div>
            <div>
                <h2>CUDA:</h2>
                <h1 style="color: rgb(255, 255, 255);">enabled</h1>
            </div>
            <div>
                <h2>FRAME SIZE:</h2>
                <h1 id="frameSize" style="color: rgb(255, 255, 255);">0</h1>
            </div>
        </div>

        <div>
            <a class="glow" style="border-radius: 5px; background-color:#383838;  margin: 7px; padding: 10px; box-shadow: 6px 4px 8px #000000;" href="{{pathToRenderedFile}}">Download video</a>
            <a style="border-radius: 5px; background-color:#383838;  padding: 10px; box-shadow: 6px 4px 8px #000000;" href="http://192.168.0.12:8000">Make new video</a>
        </div>

        <script>
            var working = 0;
            var frameWidth = 0;
            var frameHeight = 0;

            var myTimer = setInterval(function() {
                $.ajax({
                    url: '/update',
                    type: 'POST',
                    success: function(response) {
                        console.log(response);
                        //$("#num").html(response["value"]);
                        $("#num").html(response["value"]);
                        $("#framesCount").html(response["totalFrames"]);
                        $("#progress").html(response["progress"] + "%");
                        $("#fps").html(response["fps"]);
                        $("#cpu").html(response["cpuUsage"] + "%");
                        $("#freeRam").html(response["freeRam"] + "GB");
                        frameWidth = response["frameWidth"]
                        frameHeight = response["frameHeight"]
                        $("#frameSize").html(frameWidth + "x" + frameHeight);

                        working = response["workingOn"];

                        //if (working == false) {
                        //clearInterval(myTimer);
                        //}

                    },
                    error: function(error) {
                        console.log(error);
                    }
                })
            }, 1000);

            var myTimer2 = setInterval(function() {
                var positionSlider = document.getElementById("positionId");
                var outputPosition = document.getElementById("positionValue");
                var positionSliderValue = positionSlider.value;

                var cannyBlurSlider = document.getElementById("cannyBlurId");                
                var cannyBlurOutput = document.getElementById("cannyBlurValue");
                var sliderValue = cannyBlurSlider.value;
                
                outputPosition.innerHTML = positionSlider.value;
                cannyBlurOutput.innerHTML = cannyBlurSlider.value; 
                
                positionSlider.oninput = function() {
                    outputPosition.innerHTML = this.value;                                    
                }
               
                cannyBlurSlider.oninput = function() {
                    cannyBlurOutput.innerHTML = this.value;                                    
                }                

                $.ajax({
                      type: "POST",
                      contentType: "application/json;charset=utf-8",
                      url: "/update2",
                      traditional: "true",
                      data: JSON.stringify({sliderValue, positionSliderValue}),
                      dataType: "json"
                      });

            }, 300);

        </script>
    </div>
</body>