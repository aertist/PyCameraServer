<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>Video Editor</title>

    <link rel="stylesheet" href="static/main.css">

</head>

<body style="background-color:#1d1d1d;">
    <div style="text-align: center;">
        <div><img style="max-width: 50%; border-radius: 20px; box-shadow: 6px 4px 8px #000000;" src="{{ url_for('video_feed') }}"></div>
        <div id="grid">
            <div>
                <h1 id="num" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h1 id="framesCount" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h1 id="progress" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h1 id="fps" style="color: rgb(255, 255, 255);">0</h1>
            </div>

            <div>
                <h1 id="cpu" style="color: rgb(255, 255, 255);">0</h1>
            </div>
            <div>
                <h1 id="freeRam" style="color: rgb(255, 255, 255);"></h1>
            </div>
            <div>
                <h1 style="color: rgb(255, 255, 255);">enabled</h1>
            </div>
            <div>
                <h1 id="frameSize" style="color: rgb(255, 255, 255);">0</h1>
            </div>
        </div>

        <br>
            <br>
            <div>
                <a class="glow" style="border-radius: 5px; background-color:#383838;   padding: 10px; box-shadow: 6px 4px 8px #000000;" onclick="sendStartCommand()"">RESTART</a>
                <a class="glow" style="border-radius: 5px; background-color:#383838;   padding: 10px; box-shadow: 6px 4px 8px #000000;" href="{{pathToRenderedFile}}" ">DOWNLOAD</a>
                <a style="border-radius: 5px; background-color:#383838;  padding: 10px; box-shadow: 6px 4px 8px #000000;" href="http://192.168.0.12:8000">MAKE NEW</a>
            </div>
            <br>
        
        <div>
            <div style="display: inline-block; font-size: 24px; color: white;">Position:</div>
            <div style=" display: inline-block;font-size: 28px; color: white;" id="positionValue"></div>
            <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 20px; background-color: rgb(233, 212, 30); width: 810px;" type="range" min="1" max="1000" step="1" value="50" class="slider" id="positionId">            </div>
       </div>
        <div style="display: inline-block; max-width: 1000px; text-align: center;">
            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Saturation:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="saturationValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="500" step="3" value="100" class="slider" id="saturationId">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Edge Blur:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="100" step="3" value="50" class="slider" id="cannyBlurId">            </div>
            </div>
           
            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Background Blur:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Threshold Details:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Threshold Lines:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div>

            <div style="display: inline-block; " >
                <div style="display: inline-block; font-size: 24px; color: white;">Line Thickness:</div>
                <div style=" display: inline-block;font-size: 28px; color: white;" id="cannyBlurValue"></div>
                <div><input style="-webkit-appearance: none; appearance: none; border-radius: 10px; height: 30px; background-color: rgb(220, 220, 220); width: 400px;" type="range" min="1" max="100" step="2" value="50" class="slider" id="myRange">            </div>
            </div> 
        </div>

        <script>
            var working = 0;
            var frameWidth = 0;
            var frameHeight = 0;
            var videoResetCommand = false;

            function sendStartCommand() {
                videoResetCommand = true;
            }

            var myTimer = setInterval(function() {
                $.ajax({
                    url: '/update',
                    type: 'POST',
                    success: function(response) {
                        console.log(response);
                        //$("#num").html(response["value"]);
                        $("#num").html(response["value"]);
                        $("#framesCount").html(response["totalFrames"]);
                        $("#progress").html(response["progress"] + "%");
                        $("#fps").html(response["fps"]);
                        $("#cpu").html(response["cpuUsage"] + "%");
                        $("#freeRam").html(response["freeRam"] + "GB");
                        frameWidth = response["frameWidth"]
                        frameHeight = response["frameHeight"]
                        $("#frameSize").html(frameWidth + "x" + frameHeight);

                        working = response["workingOn"];

                        //if (working == false) {
                        //clearInterval(myTimer);
                        //}

                    },
                    error: function(error) {
                        console.log(error);
                    }
                })
            }, 1000);

            var myTimer2 = setInterval(function() {
                var positionSlider = document.getElementById("positionId");
                var outputPosition = document.getElementById("positionValue");
                var positionSliderValue = positionSlider.value;

                var saturationSlider = document.getElementById("saturationId");                
                var saturationOutput = document.getElementById("saturationValue");
                var saturationSliderValue = saturationSlider.value;

                var cannyBlurSlider = document.getElementById("cannyBlurId");                
                var cannyBlurOutput = document.getElementById("cannyBlurValue");
                var sliderValue = cannyBlurSlider.value;

                outputPosition.innerHTML = positionSlider.value;
                saturationOutput.innerHTML = saturationSlider.value;
                cannyBlurOutput.innerHTML = cannyBlurSlider.value; 
                
                positionSlider.oninput = function() {
                    outputPosition.innerHTML = this.value;                                    
                }

                saturationSlider.oninput = function() {
                    saturationOutput.innerHTML = this.value;                                    
                }
               
                cannyBlurSlider.oninput = function() {
                    cannyBlurOutput.innerHTML = this.value;                                    
                }                

                $.ajax({
                      type: "POST",
                      contentType: "application/json;charset=utf-8",
                      url: "/update2",
                      traditional: "true",
                      data: JSON.stringify({sliderValue, saturationSliderValue, positionSliderValue, videoResetCommand}),
                      dataType: "json"
                      });
                      
                      videoResetCommand = false;

            }, 300);

        </script>
    </div>
</body>